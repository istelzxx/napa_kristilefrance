<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Directory</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Poppins', sans-serif;
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card-hover {
      transition: all 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .add-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .add-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .edit-btn {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
    }

    .delete-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }

    .edit-btn:hover, .delete-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .pagination a, .pagination strong {
      display: inline-block;
      padding: 10px 16px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      color: #374151;
      font-weight: 500;
      transition: all 0.2s ease;
      border: 1px solid rgba(255,255,255,0.2);
      text-decoration: none;
    }

    .pagination a:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      transform: scale(1.1);
    }

    .pagination strong {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-indigo-100">

  <!-- Navigation -->
  <nav class="fixed top-0 w-full bg-white/80 backdrop-blur-lg border-b border-white/30 shadow-md z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full flex items-center justify-center">
          <i class="fas fa-users text-white text-lg"></i>
        </div>
        <span class="text-xl font-bold gradient-text">UserHub</span>
      </div>
      <a href="<?=site_url('users/create')?>" class="add-btn">
        <i class="fas fa-plus"></i>
        Add User
      </a>
    </div>
  </nav>

  <!-- Header -->
  <section class="pt-32 pb-16 text-center">
    <div class="max-w-4xl mx-auto px-6">
      <h1 class="text-5xl md:text-7xl font-bold gradient-text mb-4">User Directory</h1>
      <p class="text-gray-600 text-lg">Manage your users with elegance and control</p>
    </div>
  </section>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-6 pb-16">
    <!-- Logged In User -->
    <?php if(!empty($logged_in_user)): ?>
      <div class="mb-8 student-card p-6 text-center mx-auto max-w-2xl">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">
          Welcome, <span class="gradient-text"><?= html_escape($logged_in_user['username']); ?></span>!
        </h2>
        <p class="text-gray-600 font-medium">Role: <?= html_escape($logged_in_user['role']); ?></p>
      </div>
    <?php else: ?>
      <div class="mb-6 bg-red-100 border border-red-300 text-red-700 px-6 py-4 rounded-xl text-center">
        Logged in user not found.
      </div>
    <?php endif; ?>

    <!-- Search Bar -->
    <div class="mb-8 flex flex-col md:flex-row gap-6 items-center justify-between">
      <form method="get" action="<?=site_url('users');?>" class="relative max-w-md w-full">
        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        <input type="text" name="q" 
               value="<?=html_escape($_GET['q'] ?? '')?>" 
               placeholder="Search users by name or email..." 
               class="w-full bg-white/90 border border-gray-200 rounded-full px-12 py-3 text-gray-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
        <?php if (!empty($_GET['q'])): ?>
          <a href="<?=site_url('users');?>" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
          </a>
        <?php endif; ?>
      </form>
    </div>

    <!-- Table -->
    <div class="student-card overflow-hidden card-hover">
      <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-4 font-semibold grid grid-cols-5 gap-4">
        <div>ID</div>
        <div>Username</div>
        <div>Email</div>
        <div>Role</div>
        <div class="text-center">Actions</div>
      </div>

      <div class="divide-y divide-gray-200 bg-white/90">
        <?php foreach(html_escape($users) as $user): ?>
          <div class="grid grid-cols-5 gap-4 p-4 hover:bg-purple-50 transition-colors">
            <div class="font-semibold text-purple-600">#<?=($user['id']);?></div>
            <div class="font-medium"><?=($user['username']);?></div>
            <div class="text-gray-600"><?=($user['email']);?></div>
            <div class="font-medium"><?=($user['role']);?></div>
            <div class="flex justify-center space-x-2">
              <?php if($logged_in_user['role'] === 'admin' || $logged_in_user['id'] == $user['id']): ?>
                <a href="<?=site_url('users/update/'.$user['id']);?>" class="action-btn edit-btn px-4 py-2 rounded-md">
                  <i class="fas fa-edit mr-1"></i>Edit
                </a>
              <?php endif; ?>
              <?php if($logged_in_user['role'] === 'admin'): ?>
                <a href="<?=site_url('users/delete/'.$user['id']);?>" 
                   onclick="return confirm('Are you sure you want to delete this record?');" 
                   class="action-btn delete-btn px-4 py-2 rounded-md">
                  <i class="fas fa-trash mr-1"></i>Delete
                </a>
              <?php endif; ?>
            </div>
          </div>
        <?php endforeach; ?>
      </div>
    </div>

    <!-- Pagination -->
    <div class="mt-8 flex justify-center">
      <div class="pagination"><?= $page; ?></div>
    </div>

    <!-- Logout Button -->
    <div class="flex justify-center mt-8">
      <a href="<?= site_url('auth/logout'); ?>" 
         class="action-btn delete-btn px-6 py-3 rounded-full"
         onclick="return confirm('Are you sure you want to log out?')">
        <i class="fas fa-sign-out-alt mr-2"></i>
        Logout
      </a>
    </div>
  </div>

  <script>
    document.documentElement.style.scrollBehavior = 'smooth';
  </script>
</body>
</html>
